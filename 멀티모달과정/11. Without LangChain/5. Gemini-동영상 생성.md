
# Veo3로 동영상 생성

```python
import time

from google import genai

from google.genai import types

  

client = genai.Client()

  

# prompt = """A close up of two people staring at a cryptic drawing on a wall, torchlight flickering.

# A man murmurs, 'This must be it. That's the secret code.' The woman looks at him and whispering excitedly, 'What did you find?'"""

prompt = """ 횃불이 깜빡이는 가운데, 두 사람이 벽에 그려진 의미심장한 그림을 클로즈업해서 쳐다보고 있다.

 한 남자가 중얼거린다. "이게 틀림없어. 저게 비밀 암호야." 여자가 흥분한 목소리로 속삭이며 그를 쳐다본다. "어떻게 찾았은거야?"

 남자가 다시 대답한다. "나는 다 알 수 있어. 이건 개꿈이거든"

"""

  

try:

    operation = client.models.generate_videos(

        model="veo-3.0-generate-preview",

        prompt=prompt,

    )

  

    # Poll the operation status until the video is ready.

    max_attempts = 60  # 최대 10분 대기 (10초씩 60번)

    attempts = 0

  

    while not operation.done and attempts < max_attempts:

        print(

            f"Waiting for video generation to complete... (attempt {attempts + 1}/{max_attempts})"

        )

        time.sleep(10)

        operation = client.operations.get(operation)

        attempts += 1

  

    if not operation.done:

        print("Video generation timed out after 10 minutes")

    elif operation.response is None:

        print("Video generation completed but no response received")

        print(f"Operation status: {operation}")

    elif (

        not hasattr(operation.response, "generated_videos")

        or not operation.response.generated_videos

    ):

        print("Video generation completed but no videos were generated")

        print(f"Response: {operation.response}")

    else:

        # Download the generated video.

        generated_video = operation.response.generated_videos[0]

        client.files.download(file=generated_video.video)

        generated_video.video.save("dialogue_example.mp4")

        print("Generated video saved to dialogue_example.mp4")

  

except Exception as e:

    print(f"Error occurred during video generation: {e}")

    print(f"Error type: {type(e).__name__}")
```

### 1단계: 동영상 생성 작업 시작


```Python
operation = client.models.generate_videos(
    model="veo-3.0-generate-preview",
    prompt=prompt,
)
```

- **`operation = ...`**: `generate_videos` 메서드는 동영상 생성을 요청하고, 작업이 즉시 시작됩니다. 하지만 동영상이 완성될 때까지 기다리지 않고, **작업의 현재 상태를 담고 있는 `operation` 객체**를 바로 반환합니다. 동영상 자체는 이 객체에 들어있지 않습니다.
    

### 2단계: 작업 상태 반복 확인 (Polling)


```Python
# Poll the operation status until the video is ready.
max_attempts = 60  # 최대 10분 대기 (10초씩 60번)
attempts = 0

while not operation.done and attempts < max_attempts:
    print(
        f"Waiting for video generation to complete... (attempt {attempts + 1}/{max_attempts})"
    )
    time.sleep(10)
    operation = client.operations.get(operation)
    attempts += 1
```

- **`max_attempts`, `attempts`**: 동영상 생성이 너무 오래 걸릴 경우를 대비해 **최대 대기 시간(타임아웃)**을 설정하는 변수들입니다.
    
- **`while not operation.done and attempts < max_attempts:`**: 이 루프는 `operation.done` 상태가 `True`가 되거나, `attempts`가 `max_attempts`에 도달할 때까지 계속 반복됩니다. 즉, "작업이 아직 완료되지 않았고, 타임아웃에 걸리지 않았다면"이라는 조건입니다.
    
- **`print(...)`**: 사용자에게 현재 대기 중임을 알려주는 출력 메시지입니다.
    
- **`time.sleep(10)`**: 서버에 부담을 주지 않기 위해 10초씩 프로그램을 멈춥니다.
    
- **`operation = client.operations.get(operation)`**: 이 줄이 **폴링(polling)**의 핵심입니다. 이전 `operation` 객체를 사용해 API에 "이 작업이 끝났니?"라고 물어보고, 응답으로 온 **최신 작업 상태**로 `operation` 변수를 갱신합니다.
    

### 3단계: 작업 완료 후 결과 처리 및 예외 처리


```Python
if not operation.done:
    print("Video generation timed out after 10 minutes")
elif operation.response is None:
    print("Video generation completed but no response received")
    print(f"Operation status: {operation}")
elif (
    not hasattr(operation.response, "generated_videos")
    or not operation.response.generated_videos
):
    print("Video generation completed but no videos were generated")
    print(f"Response: {operation.response}")
else:
    # Download the generated video.
    generated_video = operation.response.generated_videos[0]
    client.files.download(file=generated_video.video)
    generated_video.video.save("dialogue_example.mp4")
    print("Generated video saved to dialogue_example.mp4")
```

- **`if not operation.done:`**: `while` 루프가 `attempts` 때문에 종료된 경우입니다. **작업이 타임아웃**된 상황을 처리합니다.
    
- **`elif operation.response is None:`**: 작업은 완료(`operation.done` = True)되었지만, 서버로부터 **응답(response)을 받지 못해** 실패한 경우를 처리합니다.
    
- **`elif ...`**: 작업이 완료되었고 응답도 받았지만, 응답에 **동영상 데이터가 포함되어 있지 않은** 경우를 처리합니다.
    
- **`else:`**: 위의 모든 조건을 통과한 **성공적인 경우**입니다.
    
    - **`generated_video = operation.response.generated_videos[0]`**: 응답 객체에서 생성된 동영상 목록 중 첫 번째 동영상 데이터를 가져옵니다.
        
    - **`client.files.download(...)`**: 동영상 데이터를 **클라이언트의 로컬 메모리로 다운로드**합니다.
        
    - **`generated_video.video.save(...)`**: 다운로드한 동영상 데이터를 `dialogue_example.mp4` 파일로 **저장**합니다.