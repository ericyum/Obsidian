
## 캐싱(Caching)

LangChain은 LLM을 위한 선택적 캐싱 레이어를 제공합니다.

이는 두 가지 이유로 유용합니다.

- 동일한 완료를 여러 번 요청하는 경우 LLM 공급자에 대한 **API 호출 횟수를 줄여 비용을 절감**할 수 있습니다.
    
- LLM 제공업체에 대한 **API 호출 횟수를 줄여 애플리케이션의 속도를 높일 수** 있습니다.
    


```python
# API KEY를 환경변수로 관리하기 위한 설정 파일
from dotenv import load_dotenv

# API KEY 정보로드
load_dotenv()
```

```
True
```


```python
# LangSmith 추적을 설정합니다. https://smith.langchain.com
# !pip install langchain-teddynote
from langchain_teddynote import logging

# 프로젝트 이름을 입력합니다.
logging.langsmith("CH04-Models")
```

```
LangSmith 추적을 시작합니다.
[프로젝트명]
CH04-Models
```

모델과 프롬프트를 생성합니다


```python
from langchain_openai import ChatOpenAI
from langchain_core.prompts import PromptTemplate

# 모델을 생성합니다.
llm = ChatOpenAI(model_name="gpt-3.5-turbo")

# 프롬프트를 생성합니다.
prompt = PromptTemplate.from_template("{country} 에 대해서 200자 내외로 요약해줘")

# 체인을 생성합니다.
chain = prompt | llm
```


```python
%%time 
response = chain.invoke({"country": "한국"})
print(response.content)
```

```
한국은 동아시아에 위치한 발전된 경제국가로, 서울을 수도로 하는 대한민국과 평양을 수도로 하는 북한으로 구성되어 있다. 한반도의 대부분을 차지하는 한국은 주로 산악지형으로 이루어져 있으며, 사계절 모두 뚜렷한 기후를 가지고 있다. 한국은 고려, 조선 등 다양한 왕조를 거쳐 역사적으로도 다양한 문화를 형성해 왔으며, 현재는 K-pop, K-drama 등을 통해 한류 문화의 선두 주자로 성장하고 있다. 또한 IT 기술과 자동차 산업 등 다양한 분야에서 세계적인 기업을 배출하며 꾸준히 경제력을 유지하고 있다. 추가로, 한국은 전통적인 음식과 문화뿐만 아니라 최신 기술과 스타트업 생태계까지 다양한 측면을 가지고 있어 많은 이들의 관심을 받고 있다.
CPU times: total: 109 ms
Wall time: 2.62 s
```

## InMemoryCache

인메모리 캐시를 사용하여 동일 질문에 대한 답변을 저장하고, 캐시에 저장된 답변을 반환합니다.


```python
%%time
from langchain.globals import set_llm_cache
from langchain.cache import InMemoryCache

# 인메모리 캐시를 사용합니다.
set_llm_cache(InMemoryCache())

# 체인을 실행합니다.
response = chain.invoke({"country": "한국"})
print(response.content)
```

```
한국은 동아시아에 위치한 섬나라로, 서울이 수도이다. 경제적으로 선진국으로 발전하였으며, 세계적으로 인정받는 기술 및 문화를 생산하는 나라이다. 한국은 고대부터 문화적 발전이 이루어져 왔고, 한글과 한국 불교, 한국 민화 등 독특한 문화유산을 갖고 있다. 주요 산업은 반도체, 자동차, 조선업, IT 등이 있으며, 글로벌 기업인 삼성, 현대, LG 등이 이 국가에서 발전하고 있다. 또한 한류 열풍으로 한국 문화는 전 세계적으로 사랑받고 있다. 현재는 북한과의 관계 개선을 통해 평화로운 한반도를 추구하고 있다.
CPU times: total: 375 ms
Wall time: 4 s
```


```python
%%time
# 체인을 실행합니다.
response = chain.invoke({"country": "한국"})
print(response.content)
```

```
한국은 동아시아에 위치한 섬나라로, 서울이 수도이다. 경제적으로 선진국으로 발전하였으며, 세계적으로 인정받는 기술 및 문화를 생산하는 나라이다. 한국은 고대부터 문화적 발전이 이루어져 왔고, 한글과 한국 불교, 한국 민화 등 독특한 문화유산을 갖고 있다. 주요 산업은 반도체, 자동차, 조선업, IT 등이 있으며, 글로벌 기업인 삼성, 현대, LG 등이 이 국가에서 발전하고 있다. 또한 한류 열풍으로 한국 문화는 전 세계적으로 사랑받고 있다. 현재는 북한과의 관계 개선을 통해 평화로운 한반도를 추구하고 있다.
CPU times: total: 0 ns
Wall time: 2 ms
```

## SQLite Cache


```python
from langchain_community.cache import SQLiteCache
from langchain_core.globals import set_llm_cache
import os

# 캐시 디렉토리를 생성합니다.
if not os.path.exists("cache"):
    os.makedirs("cache")

# SQLiteCache를 사용합니다.
set_llm_cache(SQLiteCache(database_path="cache/llm_cache.db"))
```


```python
%%time 
# 체인을 실행합니다.
response = chain.invoke({"country": "한국"})
print(response.content)
```

```
한국은 동아시아에 위치한 고인의 나라로, 서울이 수도이다. 전통적인 문화와 현대화가 공존하는 나라로, 한글이라는 독특한 문자를 사용한다. 경제는 세계에서 세 번째로 큰 규모를 자랑하며, 기술과 엔터테인먼트 산업이 발달해있다. 대한민국은 미투 운동이나 분단된 남북관계 등의 사회문제를 안고 있지만, 역사적인 장소와 맛있는 음식, 아름다운 자연환경으로 많은 관광객을 매료시킨다. 한국은 고대의 유적지와 현대의 첨단 도시가 어우러진 다채로운 모습을 보여주며, 한류 열풍으로 전 세계에 그 존재감을 널리 알리고 있다.
CPU times: total: 15.6 ms
Wall time: 2.13 s
```


```python
%%time 
# 체인을 실행합니다.
response = chain.invoke({"country": "한국"})
print(response.content)
```

```
한국은 동아시아에 위치한 고인의 나라로, 서울이 수도이다. 전통적인 문화와 현대화가 공존하는 나라로, 한글이라는 독특한 문자를 사용한다. 경제는 세계에서 세 번째로 큰 규모를 자랑하며, 기술과 엔터테인먼트 산업이 발달해있다. 대한민국은 미투 운동이나 분단된 남북관계 등의 사회문제를 안고 있지만, 역사적인 장소와 맛있는 음식, 아름다운 자연환경으로 많은 관광객을 매료시킨다. 한국은 고대의 유적지와 현대의 첨단 도시가 어우러진 다채로운 모습을 보여주며, 한류 열풍으로 전 세계에 그 존재감을 널리 알리고 있다.
CPU times: total: 0 ns
Wall time: 0 ns
```