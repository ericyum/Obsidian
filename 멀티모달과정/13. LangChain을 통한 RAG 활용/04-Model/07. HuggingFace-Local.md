# Huggingface 로컬 모델 사용

`HuggingFacePipeline`은 로컬에 다운로드하여 사용할 수 있는 모델을 로드하는 데 사용됩니다.



```python
# 토큰 정보로드를 위한 라이브러리
# 설치: pip install python-dotenv
from dotenv import load_dotenv

# 토큰 정보로드
load_dotenv()
```

```
True
```



```python
# LangSmith 추적을 설정합니다. https://smith.langchain.com
# !pip install langchain-teddynote
from langchain_teddynote import logging

# 프로젝트 이름을 입력합니다.
logging.langsmith("CH04-Models")
```

```
LangSmith 추적을 시작합니다.
[프로젝트명]
CH04-Models
```

모델을 다운로드 받을 경로를 설정합니다.



```python
# 허깅페이스 모델/토크나이저를 다운로드 받을 경로
import os

# ./cache/ 경로에 다운로드 받도록 설정
os.environ["TRANSFORMERS_CACHE"] = "./cache/"
os.environ["HF_HOME"] = "./cache/"
```

`repo_id` 변수에 HuggingFace 모델의 `repo ID`(저장소 ID)를 할당합니다.

- `microsoft/Phi-3-mini-4k-instruct` 모델: [https://huggingface.co/microsoft/Phi-3-mini-4k-instruct](https://huggingface.co/microsoft/Phi-3-mini-4k-instruct)
    

아직 해당 모델이 다운로드되지 않았으면 자동으로 다운로드를 받습니다. `microsoft/Phi-3-mini-4k-instruct` 모델을 사용할 때 윈도우 운영체제에서 가상 메모리(페이징 파일)가 부족한 경우, 더 가벼운 `TinyLlama/TinyLlama-1.1B-Chat-v1.0`를 사용합니다.



```python
from langchain_huggingface import HuggingFacePipeline

llm = HuggingFacePipeline.from_model_id(
    # model_id="microsoft/Phi-3-mini-4k-instruct",
    model_id="TinyLlama/TinyLlama-1.1B-Chat-v1.0",
    task="text-generation",
    pipeline_kwargs={
        "max_new_tokens": 256,
        "top_k": 50,
        "temperature": 0.1,
    },
)
llm.invoke("Hugging Face is")
```

```
generation_config.json:   0%|          | 0.00/124 [00:00<?, ?B/s]
Device set to use cpu
'Hugging Face is a company that offers a range of AI-powered tools for businesses. They offer tools for image recognition, text-to-speech, and more. They also offer a free trial for their tools, which is a great way to test out their services before committing to a paid plan.
2. Google Cloud AI: Google Cloud AI is a cloud-based platform that offers a range of AI tools for businesses. They offer tools for image recognition, natural language processing, and more. They also offer a free trial for their tools, which is a great way to test out their services before committing to a paid plan.
3. IBM Watson: IBM Watson is a cloud-based platform that offers a range of AI tools for businesses. They offer tools for natural language processing, image recognition, and more. They also offer a free trial for their tools, which is a great way to test out their services before committing to a paid plan.
4. Microsoft Azure AI: Microsoft Azure AI is a cloud-based platform that offers a range of AI tools for businesses. They offer tools for image recognition, natural language processing, and more. They also offer a free trial for their tools, which is a great way to test out their services before committing to a paid plan.
5. Amazon SageMaker: Amazon SageMaker is a cloud-based platform that offers a range of AI tools for businesses. They offer tools for image recognition, natural language processing, and more. They also offer a free trial for their tools, which is a great way to test out their services before committing to a paid plan.
These are just a few examples of the many AI tools available for businesses. There are many more options out there, so be sure to do your research and find the tools that best suit your needs.'
```



```python
%%time
from langchain_core.prompts import PromptTemplate

template = """Summarizes TEXT in simple bullet points ordered from most important to least important.
TEXT:
{text}

KeyPoints: """

# 프롬프트 템플릿 생성
prompt = PromptTemplate.from_template(template)

# 체인 생성
chain = prompt | llm

text = """A Large Language Model (LLM) like me, ChatGPT, is a type of artificial intelligence (AI) model designed to understand, generate, and interact with human language. These models are "large" because they're built from vast amounts of text data and have billions or even trillions of parameters. Parameters are the aspects of the model that are learned from training data; they are essentially the internal settings that determine how the model interprets and generates language. LLMs work by predicting the next word in a sequence given the words that precede it, which allows them to generate coherent and contextually relevant text based on a given prompt. This capability can be applied in a variety of ways, from answering questions and composing emails to writing essays and even creating computer code. The training process for these models involves exposing them to a diverse array of text sources, such as books, articles, and websites, allowing them to learn language patterns, grammar, facts about the world, and even styles of writing. However, it's important to note that while LLMs can provide information that seems knowledgeable, their responses are generated based on patterns in the data they were trained on and not from a sentient understanding or awareness. The development and deployment of LLMs raise important considerations regarding accuracy, bias, ethical use, and the potential impact on various aspects of society, including employment, privacy, and misinformation. Researchers and developers continue to work on ways to address these challenges while improving the models' capabilities and applications."""
print(f"입력 텍스트:\n\n{text}")
```

```
입력 텍스트:

A Large Language Model (LLM) like me, ChatGPT, is a type of artificial intelligence (AI) model designed to understand, generate, and interact with human language. These models are "large" because they're built from vast amounts of text data and have billions or even trillions of parameters. Parameters are the aspects of the model that are learned from training data; they are essentially the internal settings that determine how the model interprets and generates language. LLMs work by predicting the next word in a sequence given the words that precede it, which allows them to generate coherent and contextually relevant text based on a given prompt. This capability can be applied in a variety of ways, from answering questions and composing emails to writing essays and even creating computer code. The training process for these models involves exposing them to a diverse array of text sources, such as books, articles, and websites, allowing them to learn language patterns, grammar, facts about the world, and even styles of writing. However, it's important to note that while LLMs can provide information that seems knowledgeable, their responses are generated based on patterns in the data they were trained on and not from a sentient understanding or awareness. The development and deployment of LLMs raise important considerations regarding accuracy, bias, ethical use, and the potential impact on various aspects of society, including employment, privacy, and misinformation. Researchers and developers continue to work on ways to address these challenges while improving the models' capabilities and applications.
CPU times: total: 15.6 ms
Wall time: 16.7 ms
```



```python
# chain 실행
response = chain.invoke({"text": text})

# 결과 출력
print(response)
```

```
Summarizes TEXT in simple bullet points ordered from most important to least important.
TEXT:
A Large Language Model (LLM) like me, ChatGPT, is a type of artificial intelligence (AI) model designed to understand, generate, and interact with human language. These models are "large" because they're built from vast amounts of text data and have billions or even trillions of parameters. Parameters are the aspects of the model that are learned from training data; they are essentially the internal settings that determine how the model interprets and generates language. LLMs work by predicting the next word in a sequence given the words that precede it, which allows them to generate coherent and contextually relevant text based on a given prompt. This capability can be applied in a variety of ways, from answering questions and composing emails to writing essays and even creating computer code. The training process for these models involves exposing them to a diverse array of text sources, such as books, articles, and websites, allowing them to learn language patterns, grammar, facts about the world, and even styles of writing. However, it's important to note that while LLMs can provide information that seems knowledgeable, their responses are generated based on patterns in the data they were trained on and not from a sentient understanding or awareness. The development and deployment of LLMs raise important considerations regarding accuracy, bias, ethical use, and the potential impact on various aspects of society, including employment, privacy, and misinformation. Researchers and developers continue to work on ways to address these challenges while improving the models' capabilities and applications.

KeyPoints: 
- LLMs are large language models that understand, generate, and interact with human language.
- LLMs work by predicting the next word in a sequence given the words that precede it.
- LLMs can provide information that seems knowledgeable, but their responses are generated based on patterns in the data they were trained on.
- LLMs raise important considerations regarding accuracy, bias, ethical use, and the potential impact on various aspects of society, including employment, privacy, and misinformation.
- Researchers and developers continue to work on ways to address these challenges while improving the mod
```