# 비디오(Video) 질의 응답 LLM (Gemini)

**주요 흐름**

1. `File API`를 사용하여 비디오 파일을 업로드합니다.
    
2. `GenerateContent` 요청을 통해 비디오에 대한 질문을 요청합니다.
    
3. 생성된 응답을 확인합니다.
    
4. 업로드한 Video 파일을 삭제합니다.
    

**중요:**

- 본 튜토리얼의 `File API` 는 인증 및 접근을 위해 `API keys`를 사용합니다.
    
- 업로드된 파일은 `API key`의 클라우드 프로젝트와 연결됩니다.
    
- 다른 `Gemini API`와 달리, `API key`는 `File API`에 업로드한 데이터에 대한 접근 권한도 부여하므로 `API key`를 안전하게 보관하는 데 특별히 주의해야 합니다.
    

**Reference**

- [Gemini API(Cookbook) - Video](https://www.google.com/search?q=https://ai.google.dev/api/rest/v1/models/generateContent%23media)
    

**API KEY 발급**

- [Google AI Studio](https://www.google.com/search?q=https://ai.google.dev/docs/ai_studio_quickstart)에서 API 키를 발급받아 환경변수에 설정해야 합니다.
    



```python
# API KEY를 환경변수로 관리하기 위한 설정 파일
from dotenv import load_dotenv

# API KEY 정보로드
load_dotenv()
```

```
True
```

## LangChain을 활용한 Gemini-Pro-Vision 모델 활용

- Google AI의 `gemini-pro-vision`은 멀티모달(multimodal) 기능을 지원하여 텍스트와 이미지를 동시에 처리할 수 있는 모델입니다.
    
- 이 모델을 사용하면 이미지에 대한 질문에 답변하거나 이미지에 대한 설명을 생성하는 등의 작업을 수행할 수 있습니다.
    
- Google AI에서 제공하는 `ChatGoogleGenerativeAI` 클래스를 사용합니다.
    



```python
# !pip install -qU langchain-google-genai
# !pip install -qU langchain-teddynote
```



```python
# LangSmith 추적을 설정합니다.
from langchain_teddynote import logging

logging.langsmith("CH06-Gemini-Video")
```

```
LangSmith 추적을 시작합니다.
[프로젝트명]
CH06-Gemini-Video
```

### 이미지(Image) 질의 응답 예제

- `HumanMessage` 클래스를 사용하여 텍스트와 이미지 데이터를 함께 전달합니다.
    
- 이미지는 로컬에 있는 이미지를 Base64로 인코딩하여 전송합니다.
    



```python
import os
import base64
import mimetypes

from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_core.messages import HumanMessage
from IPython.display import display, HTML

# 파일 경로
FILE_PATH = "./images/jeju-beach.jpg"

# 파일 타입을 추론
mime_type = mimetypes.guess_type(FILE_PATH)[0]
print("파일 타입:", mime_type)
print(f"{FILE_PATH} 파일 사이즈(KB):", os.path.getsize(FILE_PATH) / 1024)

# 이미지 파일을 바이너리로 읽어들여서 base64로 인코딩합니다.
with open(FILE_PATH, "rb") as f:
    image_bytes = f.read()
    image_base64 = base64.b64encode(image_bytes).decode('utf-8')

# HTML에 인코딩된 이미지를 출력
html = f"""<img src='data:{mime_type};base64,{image_base64}' width="500">"""
display(HTML(html))
```

```
파일 타입: image/jpeg
./images/jeju-beach.jpg 파일 사이즈(KB): 161.4111328125
```

```
<img src='data:image/jpeg;base64,...' width="500">
```

- `ChatGoogleGenerativeAI` 모델 인스턴스를 생성합니다.
    
- `model` 파라미터는 사용할 Gemini 모델을 지정합니다. 여기서는 `gemini-pro-vision`을 사용합니다.
    
- `temperature`는 모델의 답변 다양성을 조절하는 매개변수입니다. 값이 높을수록 더 창의적인 답변을 생성합니다.
    
- `invoke` 메서드를 사용하여 질문을 전달하고 답변을 받습니다.
    



```python
# Gemini-pro-vision 모델을 사용하여 이미지와 텍스트를 함께 전달합니다.
llm = ChatGoogleGenerativeAI(model="gemini-pro-vision", temperature=0)

# HumanMessage를 사용하여 텍스트와 이미지를 함께 전달합니다.
message = HumanMessage(
    content=[
        {
            "type": "text",
            "text": "이 사진에 대해 설명해 주세요.",
        },
        {
            "type": "image_url",
            "image_url": {
                "url": f"data:{mime_type};base64,{image_base64}"
            },
        },
    ]
)

# 모델 호출
response = llm.invoke([message])
```

```
AIMessage(content='이 사진은 아름다운 해변 풍경을 담고 있습니다. 주요 특징은 다음과 같습니다.\n\n- **맑고 푸른 바다**: 바다는 맑고 투명하며, 에메랄드빛을 띠고 있습니다.\n- **하얀 모래사장**: 해변에는 고운 하얀 모래가 넓게 펼쳐져 있습니다.\n- **검은 바위**: 바다 곳곳에 검고 큰 바위들이 있어 풍경에 독특한 대비를 더합니다.\n- **푸른 하늘과 구름**: 하늘은 맑고 푸르며, 흰 구름이 약간 떠 있습니다.\n- **평화로운 분위기**: 전반적으로 고요하고 평화로운 분위기를 자아냅니다.\n\n이 사진은 휴식과 자연의 아름다움을 느끼기에 좋은 장소임을 보여줍니다.', id='run-50a006c0-2f2f-45a2-8959-1e3df6a1523c')
```

## 동영상(Video) 파일 업로드

- [Google Generative AI SDK](https://github.com/google-gemini/generative-ai-python)를 사용하여 비디오 파일을 업로드합니다.
    
- 비디오 파일은 최대 2분까지 지원하며, 20초 이내의 짧은 비디오를 추천합니다. (용량 제한이 있을 수 있음)
    



```python
# !pip install -qU google-generativeai
```



```python
import google.generativeai as genai

# 비디오 파일 업로드
video_file_name = "google_io.mp4"
print(f"Uploading file...")
video_file = genai.upload_file(path=video_file_name, display_name=video_file_name)

print(f"Completed uploading file {video_file.uri}")
```

```
Uploading file...
Completed uploading file https://generativelanguage.googleapis.com/v1beta/files/968jh2d4ltse
```

## 동영상(Video) 질의 응답 예제



```python
# 동영상에 대한 질의
prompt = "이 영상에는 어떤 내용이 담겨있나요?"

# 모델을 Gemini 1.5 Flash로 설정
model = genai.GenerativeModel(model_name="models/gemini-1.5-flash")

# LLM 스트림 답변 요청
response = model.generate_content(
    [prompt, video_file], request_options={"timeout": 600}, stream=True
)

# 생성된 콘텐츠 출력
for chunk in response:
    print(chunk.text, end="", flush=True)
```

```
해당 영상은 Google I/O 2024의 프레젠테이션을 담고 있습니다. 이 프레젠테이션은 Google의 최신 기술과 업데이트에 대한 내용을 다루고 있습니다.
```

## 파일 삭제

- 파일은 2일 후 자동으로 삭제되거나 `files.delete()`를 사용하여 수동으로 삭제할 수 있습니다.
    



```python
# 파일 삭제
genai.delete_file(video_file.name)
```

```
영상을 삭제했습니다: https://generativelanguage.googleapis.com/v1beta/files/968jh2d4ltse
```