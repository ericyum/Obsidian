# **Document Parser?**


### 2025 도큐먼트 파서 비교! Synap DocuAnalyzer VS 업스테이지 Document Parse

https://www.youtube.com/watch?v=Zk3ipzTMe1g

# **upstage Document Parse**


#### upstage 화제의 Document Parse 개발하신 분들께 직접 물어보겠습니다!

https://www.youtube.com/watch?v=wE42SIAWCmg

```python
from dotenv import load_dotenv

  

# 환경변수 로드

load_dotenv()
```

```
True
```

### Upstage Document Parse API로 호출하기


```python
# !pip install -qU langchain-core langchain-upstage
```

```python
import os

from langchain_upstage import UpstageDocumentParseLoader

  

file_path = "./data/2103_page1.pdf"  # ex: ./document.pdf

  

loader = UpstageDocumentParseLoader(

    file_path,

    model="document-parse-250618",

    ocr="auto",

    coordinates=True,

    base64_encoding=["figure"],

)

pages = loader.load()  # or loader.lazy_load()

for page in pages:

    print(page)
```

```
page_content='<p id='0' data-category='paragraph' style='font-size:20px'>Layout Parser: A Unified Toolkit for Deep<br>Learni n g Based Document Image Analysi s</p>(중략...)
```

### 시각화를 위해 PDF 파일 PNG 이미지 파일로 변환하기

```python
# PDF를 PNG 이미지로 변환

import fitz  # PyMuPDF

from PIL import Image

import os

  
  

def pdf_to_png(pdf_path, output_path, dpi=150):

    """다이세여

    PDF 파일을 PNG 이미지로 변환하는 함수

  

    Args:

        pdf_path (str): 변환할 PDF 파일 경로

        output_path (str): 출력할 PNG 파일 경로

        dpi (int): 이미지 해상도 (DPI)

    """

    try:

        # PDF 문서 열기

        pdf_document = fitz.open(pdf_path)

  

        # 첫 번째 페이지 가져오기

        page = pdf_document[0]

  

        # 해상도 설정

        mat = fitz.Matrix(dpi / 72, dpi / 72)

  

        # 페이지를 이미지로 변환

        pix = page.get_pixmap(matrix=mat)

  

        # PNG로 저장

        pix.save(output_path)

  

        # 메모리 정리

        pdf_document.close()

  

        print(f"PDF가 성공적으로 PNG로 변환되었습니다: {output_path}")

        return True

  

    except Exception as e:

        print(f"변환 오류: {e}")

        return False

  
  

# PDF 파일 경로

pdf_file = "./data/2103_page1.pdf"

# 출력 PNG 파일 경로

png_file = "./data/test1.png"

  

# 디렉토리 존재 확인

output_dir = os.path.dirname(png_file)

if not os.path.exists(output_dir):

    os.makedirs(output_dir)

    print(f"디렉토리 생성: {output_dir}")

  

# PDF 파일 존재 확인

if os.path.exists(pdf_file):

    # PDF를 PNG로 변환

    success = pdf_to_png(pdf_file, png_file, dpi=200)

  

    if success:

        # 변환된 이미지 정보 표시

        if os.path.exists(png_file):

            from PIL import Image

  

            img = Image.open(png_file)

            print(f"변환된 이미지 크기: {img.size}")

            print(f"이미지 모드: {img.mode}")

            img.close()

else:

    print(f"PDF 파일을 찾을 수 없습니다: {pdf_file}")
```

```
PDF가 성공적으로 PNG로 변환되었습니다: [./data/test1.png](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/SBA/github/langchain-kr/06-DocumentLoader/data/test1.png) 변환된 이미지 크기: (1654, 2339) 이미지 모드: RGB
```

### 이미지상에 어노테이션 박스 그리기

```python
# pages의 metadata에서 coordinates를 읽어와서 박스 그리기

import cv2

import numpy as np

from PIL import Image

import matplotlib.pyplot as plt

import json

  

# 변환된 PNG 이미지 경로

image_path = "./data/test1.png"

  
  

# pages에서 coordinates 데이터 추출

def extract_coordinates_from_pages(pages):

    """다이세여

    pages의 metadata에서 coordinates 데이터를 추출하는 함수

  

    Args:

        pages: UpstageDocumentParseLoader로 로드된 페이지 데이터

  

    Returns:

        list: coordinates 데이터 리스트

    """

    all_coordinates = []

  

    for page in pages:

        if hasattr(page, "metadata") and "coordinates" in page.metadata:

            coordinates = page.metadata["coordinates"]

            if coordinates:

                all_coordinates.extend(coordinates)

  

    return all_coordinates

  
  

try:

    # pages에서 coordinates 추출

    if "pages" in locals() and pages:

        coordinates_from_pages = extract_coordinates_from_pages(pages)

  

        if not coordinates_from_pages:

            print("pages의 metadata에서 coordinates를 찾을 수 없습니다.")

            print("metadata 구조 확인:")

            for i, page in enumerate(pages[:1]):  # 첫 번째 페이지만 출력

                print(f"Page {i+1} metadata keys: {list(page.metadata.keys())}")

        else:

            print(

                f"pages에서 {len(coordinates_from_pages)}개의 coordinates를 찾았습니다."

            )

  

            # 이미지 로드

            image = cv2.imread(image_path)

            if image is None:

                print(f"이미지를 찾을 수 없습니다: {image_path}")

            else:

                # 이미지 크기 가져오기

                height, width = image.shape[:2]

                print(f"이미지 크기: {width} x {height}")

  

                # BGR에서 RGB로 변환

                image_rgb = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)

  

                # 각 coordinates에 대해 박스 그리기

                for i, coord_group in enumerate(coordinates_from_pages):

                    # 색상 선택 (각 박스마다 다른 색상)

                    color = (

                        int(255 * ((i % 5) + 1) / 6),

                        int(255 * (((i + 2) % 5) + 1) / 6),

                        int(255 * (((i + 4) % 5) + 1) / 6),

                    )

  

                    # coordinates 데이터 처리

                    if isinstance(coord_group, list) and len(coord_group) >= 4:

                        # 첫 번째와 세 번째 점으로 사각형 그리기

                        if all("x" in coord and "y" in coord for coord in coord_group):

                            x1 = int(coord_group[0]["x"] * width)

                            y1 = int(coord_group[0]["y"] * height)

                            x2 = int(coord_group[2]["x"] * width)

                            y2 = int(coord_group[2]["y"] * height)

  

                            # 사각형 그리기

                            cv2.rectangle(image_rgb, (x1, y1), (x2, y2), color, 2)

  

                            # 박스 번호 표시

                            cv2.putText(

                                image_rgb,

                                str(i + 1),

                                (x1, y1 - 5),

                                cv2.FONT_HERSHEY_SIMPLEX,

                                0.5,

                                color,

                                1,

                            )

  

                # 결과 이미지 디스플레이

                plt.figure(figsize=(15, 20))

                plt.imshow(image_rgb)

                plt.title(

                    f"pages metadata에서 추출한 coordinates 박스 (Total: {len(coordinates_from_pages)} boxes)"

                )

                plt.axis("off")

                plt.tight_layout()

                plt.show()

  

                print(f"총 {len(coordinates_from_pages)}개의 박스가 그려졌습니다.")

  

    else:

        print(

            "pages 변수가 정의되지 않았습니다. 먼저 3번째 셀을 실행하여 pages를 로드해주세요."

        )

  

except Exception as e:

    print(f"오류 발생: {e}")

    import traceback

  

    traceback.print_exc()
```

```
pages에서 12개의 coordinates를 찾았습니다. 이미지 크기: 1654 x 2339

[C:\Users\SBA\AppData\Local\Temp\ipykernel_2964\4261969097.py:100](file:///C:/Users/SBA/AppData/Local/Temp/ipykernel_2964/4261969097.py:100): UserWarning: Glyph 50640 (\N{HANGUL SYLLABLE E}) missing from font(s) DejaVu Sans. plt.tight_layout() [C:\Users\SBA\AppData\Local\Temp\ipykernel_2964\4261969097.py:100](file:///C:/Users/SBA/AppData/Local/Temp/ipykernel_2964/4261969097.py:100): UserWarning: Glyph 49436 (\N{HANGUL SYLLABLE SEO}) missing from font(s) DejaVu Sans. plt.tight_layout() [C:\Users\SBA\AppData\Local\Temp\ipykernel_2964\4261969097.py:100](file:///C:/Users/SBA/AppData/Local/Temp/ipykernel_2964/4261969097.py:100): UserWarning: Glyph 52628 (\N{HANGUL SYLLABLE CU}) missing from font(s) DejaVu Sans. plt.tight_layout() [C:\Users\SBA\AppData\Local\Temp\ipykernel_2964\4261969097.py:100](file:///C:/Users/SBA/AppData/Local/Temp/ipykernel_2964/4261969097.py:100): UserWarning: Glyph 52636 (\N{HANGUL SYLLABLE CUL}) missing from font(s) DejaVu Sans. plt.tight_layout() [C:\Users\SBA\AppData\Local\Temp\ipykernel_2964\4261969097.py:100](file:///C:/Users/SBA/AppData/Local/Temp/ipykernel_2964/4261969097.py:100): UserWarning: Glyph 54620 (\N{HANGUL SYLLABLE HAN}) missing from font(s) DejaVu Sans. plt.tight_layout() [C:\Users\SBA\AppData\Local\Temp\ipykernel_2964\4261969097.py:100](file:///C:/Users/SBA/AppData/Local/Temp/ipykernel_2964/4261969097.py:100): UserWarning: Glyph 48149 (\N{HANGUL SYLLABLE BAG}) missing from font(s) DejaVu Sans. plt.tight_layout() [C:\Users\SBA\AppData\Local\Temp\ipykernel_2964\4261969097.py:100](file:///C:/Users/SBA/AppData/Local/Temp/ipykernel_2964/4261969097.py:100): UserWarning: Glyph 49828 (\N{HANGUL SYLLABLE SEU}) missing from font(s) DejaVu Sans. plt.tight_layout()

(이미지)

총 12개의 박스가 그려졌습니다.
```
